function [aa,bb,cc,dd] = IWT( imMat )
% ????С???任?????????imMat ??????1/4??С?????????aa??bb??cc??dd
% ????С???任????S?????任3????????????????????imMat???256??256?????????????imde?3??????????????????
% S?任?????????? Dj-1, k = Sj, 2k +1 - Sj, 2k??Sj-1, k =  Sj, 2k + [Dj-1, k / 2] 
% ???? Sj, 2k = Sj-1, k - [Dj-1, k / 2] Sj, 2k +1 = Dj-1, k + Sj, 2k
% ???? S???????????
% dim = 256;
[dim,~]=size(imMat);
imMat = double(imMat);
% map = gray(256);
% subplot(4, 4, 1); image(imMat);colormap(map); title('? ? ??'); axis square; axis off;
% ?????к??н?????е????S???任
[imder, imdec] = decompose(imMat, dim);
% imder
% imdec
imde = imdec;
[m,n]=size(imde);
aa=imde(1:m/2,1:n/2);
bb=imde(1:m/2,n/2+1:n);
cc=imde(m/2+1:m,1:n/2);
dd=imde(m/2+1:m,n/2+1:n);
end



% imgray = mat2gray(imder); % ????????
% imwrite(imgray, 'imgraylr.bmp'); % ????1???б任??????
% imshow(imgray); % ???1???б任??????
% subplot(4, 4, 2); image(imder);colormap(map); title('1???з??'); axis square; axis off;

% imgray = mat2gray(imdec);
% imwrite(imgray, 'imgray1c.bmp');
% imshow(imgray);
% subplot(4, 4, 6); image(imdec);colormap(map); title('1???з??'); axis square; axis off;
%-----------------------------?????decompose---------------------------------
function [imder, imdec] = decompose(imMat, dim)
% ?????к??н?????????S???任, dim?????
imder = imMat;
imdec = imMat;
for i = 1:dim  % ?????н???S???任
    for j = 1:2:dim  
        imder(i, dim/2+(j+1)/2) = imMat(i, j+1) - imMat(i, j); % ??????к?????Dj-1,k
        imder(i, (j+1)/2) = imMat(i, j) + floor(imder(i, dim/2+(j+1)/2)/2); % ?????????????Sj-1,k
    end
end
% ?б任
for i = 1:dim % ?????н???S???任
    for j = 1:2:dim
        imdec(dim/2+(j+1)/2, i) = imder(j+1, i) - imder(j, i); 
        imdec((j+1)/2, i) = imder(j, i) + floor(imdec(dim/2+(j+1)/2, i)/2);
    end
end
end
